import{r as d,x as ve,g as pe,b as u,X as me,o as b,c as _e,d as o,t as y,e,w as a,C as fe,V as ge,j as k,E as _,f as p,i,Y as ye,l as Q,N as q,O,P as X,L as Y,S as Z,q as he,n as be,Z as we}from"./index-9511e055.js";import{a as Ce,d as Ve,c as G}from"./materials-40f5ef17.js";import{_ as ze}from"./_plugin-vue_export-helper-c27b6911.js";import"./storage-02b3d0a9.js";const xe={class:"admin-materials-container"},ke={class:"page-header"},Me={class:"user-info"},De={class:"admin-panel"},Ue={class:"stats-grid"},Be={class:"stat-item"},Se={class:"stat-icon document-icon"},Te={class:"stat-info"},$e={class:"stat-value"},Ee={class:"stat-item"},Ae={class:"stat-icon image-icon"},Ie={class:"stat-info"},Le={class:"stat-value"},Pe={class:"stat-item"},Ne={class:"stat-icon video-icon"},Fe={class:"stat-info"},je={class:"stat-value"},Ke={class:"stat-item"},Qe={class:"stat-icon other-icon"},qe={class:"stat-info"},Oe={class:"stat-value"},Xe={class:"search-section"},Ye={class:"material-name"},Ze={class:"pagination-container"},Ge={class:"dialog-footer"},He={class:"delete-confirm"},Je={class:"dialog-footer"},Re={__name:"AdminMaterials",setup(We){const M=d(""),D=d("all"),U=d("all"),v=d(!1),w=d(1),C=d(10),$=d(0),h=d([]),V=d(!1),z=d(!1),P=d({role:"管理员",avatar:"A"}),f=d([]),N=d([]),r=d({id:null,name:"",description:"",type:"document"}),B=ve(()=>({documentCount:f.value.filter(t=>t.type==="document").length,imageCount:f.value.filter(t=>t.type==="image").length,videoCount:f.value.filter(t=>t.type==="video").length,otherCount:f.value.filter(t=>t.type!=="document"&&t.type!=="image"&&t.type!=="video").length})),S=async()=>{v.value=!0;try{const t=await Ce();f.value=t,$.value=t.length,x()}catch(t){console.error("加载资料失败:",t),_.error("加载资料失败")}finally{v.value=!1}},x=()=>{let t=[...f.value];if(M.value){const n=M.value.toLowerCase();t=t.filter(T=>T.name.toLowerCase().includes(n)||T.description.toLowerCase().includes(n))}D.value!=="all"&&(t=t.filter(n=>n.type===D.value)),U.value!=="all"&&(t=t.filter(n=>n.uploader===U.value)),$.value=t.length;const l=(w.value-1)*C.value,E=l+C.value;N.value=t.slice(l,E)},F=()=>{w.value=1,x()},H=t=>{w.value=t,x()},J=t=>{C.value=t,x()},R=t=>{h.value=t},W=t=>{switch(t){case"document":return"primary";case"image":return"success";case"video":return"warning";default:return"info"}},ee=t=>{switch(t){case"document":return"文档";case"image":return"图片";case"video":return"视频";default:return"其他"}},le=t=>{r.value={id:t.id,name:t.name,description:t.description,type:t.type},V.value=!0},te=async()=>{v.value=!0;try{const t=f.value.findIndex(l=>l.id===r.value.id);t!==-1&&(f.value[t]={...f.value[t],name:r.value.name,description:r.value.description,type:r.value.type},_.success("资料信息更新成功"),V.value=!1,x())}catch(t){console.error("更新失败:",t),_.error("资料信息更新失败")}finally{v.value=!1}},ae=async t=>{try{await Ve(t.id),_.success("下载开始"),S()}catch(l){console.error("下载失败:",l),_.error("下载失败")}},oe=t=>{ye.confirm(`确定要删除资料 "${t.name}" 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{v.value=!0;try{await G(t.id),_.success("资料已删除"),S()}catch(l){console.error("删除失败:",l),_.error("删除失败")}finally{v.value=!1}}).catch(()=>{})},se=()=>{if(h.value.length===0){_.warning("请先选择要删除的资料");return}z.value=!0},ne=async()=>{v.value=!0;try{const t=h.value.map(l=>G(l.id));await Promise.all(t),_.success(`成功删除 ${h.value.length} 个资料`),z.value=!1,S()}catch(t){console.error("批量删除失败:",t),_.error("批量删除失败")}finally{v.value=!1}};return pe(()=>{S()}),(t,l)=>{const E=u("el-avatar"),n=u("el-icon"),T=u("el-card"),A=u("el-input"),c=u("el-option"),I=u("el-select"),g=u("el-button"),m=u("el-table-column"),ie=u("el-tag"),de=u("el-table"),ue=u("el-pagination"),L=u("el-form-item"),re=u("el-form"),j=u("el-dialog"),ce=me("loading");return b(),_e("div",xe,[o("div",ke,[l[12]||(l[12]=o("h1",null,"管理员资料管理",-1)),o("div",Me,[o("span",null,y(P.value.role),1),e(E,{size:40,class:"avatar"},{default:a(()=>[p(y(P.value.avatar),1)]),_:1})])]),o("div",De,[e(T,{class:"stats-card"},{default:a(()=>[o("div",Ue,[o("div",Be,[o("div",Se,[e(n,{size:24},{default:a(()=>[e(i(Q))]),_:1})]),o("div",Te,[o("div",$e,y(B.value.documentCount),1),l[13]||(l[13]=o("div",{class:"stat-label"},"文档",-1))])]),o("div",Ee,[o("div",Ae,[e(n,{size:24},{default:a(()=>[e(i(q))]),_:1})]),o("div",Ie,[o("div",Le,y(B.value.imageCount),1),l[14]||(l[14]=o("div",{class:"stat-label"},"图片",-1))])]),o("div",Pe,[o("div",Ne,[e(n,{size:24},{default:a(()=>[e(i(O))]),_:1})]),o("div",Fe,[o("div",je,y(B.value.videoCount),1),l[15]||(l[15]=o("div",{class:"stat-label"},"视频",-1))])]),o("div",Ke,[o("div",Qe,[e(n,{size:24},{default:a(()=>[e(i(X))]),_:1})]),o("div",qe,[o("div",Oe,y(B.value.otherCount),1),l[16]||(l[16]=o("div",{class:"stat-label"},"其他",-1))])])])]),_:1})]),o("div",Xe,[e(A,{modelValue:M.value,"onUpdate:modelValue":l[0]||(l[0]=s=>M.value=s),placeholder:"搜索资料...",class:"search-input",clearable:"",onKeyup:fe(F,["enter"])},{prefix:a(()=>[e(n,null,{default:a(()=>[e(i(Y))]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:D.value,"onUpdate:modelValue":l[1]||(l[1]=s=>D.value=s),placeholder:"所有类型",class:"file-type-select"},{default:a(()=>[e(c,{label:"所有类型",value:"all"}),e(c,{label:"文档",value:"document"}),e(c,{label:"图片",value:"image"}),e(c,{label:"视频",value:"video"}),e(c,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),e(I,{modelValue:U.value,"onUpdate:modelValue":l[2]||(l[2]=s=>U.value=s),placeholder:"所有上传者",class:"uploader-select"},{default:a(()=>[e(c,{label:"所有上传者",value:"all"}),e(c,{label:"管理员",value:"管理员"}),e(c,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"]),e(g,{type:"primary",onClick:F},{default:a(()=>[e(n,null,{default:a(()=>[e(i(Y))]),_:1}),l[17]||(l[17]=p(" 搜索 "))]),_:1}),e(g,{type:"danger",onClick:se,disabled:!h.value.length},{default:a(()=>[e(n,null,{default:a(()=>[e(i(Z))]),_:1}),l[18]||(l[18]=p(" 批量删除 "))]),_:1},8,["disabled"])]),ge((b(),k(de,{data:N.value,style:{width:"100%"},onSelectionChange:R,border:"",stripe:"",class:"materials-table"},{default:a(()=>[e(m,{type:"selection",width:"55"}),e(m,{label:"ID",prop:"id",width:"80"}),e(m,{label:"资料名称","min-width":"200"},{default:a(s=>[o("div",Ye,[s.row.type==="document"?(b(),k(n,{key:0,size:20,class:"material-icon"},{default:a(()=>[e(i(Q))]),_:1})):s.row.type==="image"?(b(),k(n,{key:1,size:20,class:"material-icon"},{default:a(()=>[e(i(q))]),_:1})):s.row.type==="video"?(b(),k(n,{key:2,size:20,class:"material-icon"},{default:a(()=>[e(i(O))]),_:1})):(b(),k(n,{key:3,size:20,class:"material-icon"},{default:a(()=>[e(i(X))]),_:1})),o("span",null,y(s.row.name),1)])]),_:1}),e(m,{label:"描述",prop:"description","min-width":"300","show-overflow-tooltip":""}),e(m,{label:"类型",prop:"type",width:"100"},{default:a(s=>[e(ie,{type:W(s.row.type),effect:"light",size:"small"},{default:a(()=>[p(y(ee(s.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"上传者",prop:"uploader",width:"120"}),e(m,{label:"上传日期",prop:"uploadDate",width:"120"}),e(m,{label:"大小",prop:"size",width:"100"}),e(m,{label:"下载次数",prop:"downloads",width:"100"}),e(m,{label:"操作",width:"250",fixed:"right"},{default:a(s=>[e(g,{type:"primary",size:"small",onClick:K=>le(s.row)},{default:a(()=>[e(n,null,{default:a(()=>[e(i(he))]),_:1}),l[19]||(l[19]=p(" 编辑 "))]),_:2},1032,["onClick"]),e(g,{type:"success",size:"small",onClick:K=>ae(s.row)},{default:a(()=>[e(n,null,{default:a(()=>[e(i(be))]),_:1}),l[20]||(l[20]=p(" 下载 "))]),_:2},1032,["onClick"]),e(g,{type:"danger",size:"small",onClick:K=>oe(s.row)},{default:a(()=>[e(n,null,{default:a(()=>[e(i(Z))]),_:1}),l[21]||(l[21]=p(" 删除 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,v.value]]),o("div",Ze,[e(ue,{"current-page":w.value,"onUpdate:currentPage":l[3]||(l[3]=s=>w.value=s),"page-size":C.value,"onUpdate:pageSize":l[4]||(l[4]=s=>C.value=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:$.value,onSizeChange:J,onCurrentChange:H,background:""},null,8,["current-page","page-size","total"])]),e(j,{modelValue:V.value,"onUpdate:modelValue":l[9]||(l[9]=s=>V.value=s),title:"编辑资料信息",width:"500px"},{footer:a(()=>[o("span",Ge,[e(g,{onClick:l[8]||(l[8]=s=>V.value=!1)},{default:a(()=>l[22]||(l[22]=[p("取消")])),_:1}),e(g,{type:"primary",onClick:te,loading:v.value},{default:a(()=>l[23]||(l[23]=[p("保存")])),_:1},8,["loading"])])]),default:a(()=>[e(re,{model:r.value,"label-width":"80px"},{default:a(()=>[e(L,{label:"资料名称"},{default:a(()=>[e(A,{modelValue:r.value.name,"onUpdate:modelValue":l[5]||(l[5]=s=>r.value.name=s),placeholder:"请输入资料名称"},null,8,["modelValue"])]),_:1}),e(L,{label:"资料描述"},{default:a(()=>[e(A,{modelValue:r.value.description,"onUpdate:modelValue":l[6]||(l[6]=s=>r.value.description=s),type:"textarea",placeholder:"请输入资料描述"},null,8,["modelValue"])]),_:1}),e(L,{label:"资料类型"},{default:a(()=>[e(I,{modelValue:r.value.type,"onUpdate:modelValue":l[7]||(l[7]=s=>r.value.type=s),placeholder:"请选择资料类型"},{default:a(()=>[e(c,{label:"文档",value:"document"}),e(c,{label:"图片",value:"image"}),e(c,{label:"视频",value:"video"}),e(c,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(j,{modelValue:z.value,"onUpdate:modelValue":l[11]||(l[11]=s=>z.value=s),title:"确认删除",width:"400px"},{footer:a(()=>[o("span",Je,[e(g,{onClick:l[10]||(l[10]=s=>z.value=!1)},{default:a(()=>l[24]||(l[24]=[p("取消")])),_:1}),e(g,{type:"danger",onClick:ne,loading:v.value},{default:a(()=>l[25]||(l[25]=[p("确认删除")])),_:1},8,["loading"])])]),default:a(()=>[o("div",He,[e(n,{class:"warning-icon"},{default:a(()=>[e(i(we))]),_:1}),o("p",null,"确定要删除选中的 "+y(h.value.length)+" 个资料吗？此操作不可恢复！",1)])]),_:1},8,["modelValue"])])}}},ol=ze(Re,[["__scopeId","data-v-453bff35"]]);export{ol as default};
