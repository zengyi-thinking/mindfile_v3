import{G as pe,u as _e,r as k,a as Y,x as me,g as ve,b as C,o as d,c as m,d as t,e as s,w as n,t as i,f as r,F as J,h as b,y as O,z as fe,j as Q,E as v,i as f,a2 as he,a1 as ye,s as B,R as ge,m as ke,p as Ce,a3 as q,a4 as Ie,a5 as Se,a6 as we,l as Te}from"./index-9511e055.js";import{r as R,A}from"./activityTracker-6427563e.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";const Ve={class:"forum-detail-container"},De={class:"page-header"},Ne={class:"header-left"},Oe={class:"user-info"},Je={key:0,class:"topic-detail"},be={class:"topic-header"},ze={class:"topic-title"},$e={class:"topic-meta"},Ee={class:"meta-left"},Le={class:"author-info"},Re={class:"author-name"},Ae={class:"publish-time"},Fe={class:"meta-right"},Ue={class:"views-count"},Be={class:"topic-content"},Pe={key:0,class:"topic-tags"},Me={class:"topic-actions"},je={class:"comments-section",id:"comments-section"},Ge={class:"comments-header"},Ke={key:0,class:"comment-list"},Ye={class:"comment-header"},Qe={class:"comment-user"},qe={class:"comment-user-info"},We={class:"comment-author"},He={class:"comment-time"},Xe={class:"comment-actions"},Ze={class:"comment-content"},et={key:0,class:"replies-list"},tt={class:"reply-header"},st={class:"reply-user"},ot={class:"reply-user-info"},lt={class:"reply-author"},nt={class:"reply-time"},at={class:"reply-actions"},it={class:"reply-content"},ct={class:"reply-to"},rt={key:1,class:"reply-form"},ut={key:0,class:"emoji-picker-container"},dt={class:"emoji-list"},pt=["onClick"],_t={class:"reply-input-container"},mt={class:"input-actions"},vt={class:"reply-form-actions"},ft={class:"comment-form",id:"comment-form"},ht={key:0,class:"emoji-picker-container"},yt={class:"emoji-list"},gt=["onClick"],kt={class:"comment-input-container"},Ct={class:"input-actions"},It={class:"comment-form-actions"},St={class:"share-dialog-content"},wt={class:"share-title"},Tt={class:"share-options"},xt={class:"share-option"},Vt={class:"share-option"},Dt={class:"share-option"},Nt={__name:"ForumDetail",setup(Ot){const w=pe(),z=_e(),I=k((()=>{const o=localStorage.getItem("currentUser");if(o)try{return JSON.parse(o)}catch(e){return console.error("解析用户数据失败",e),{role:"游客",avatar:"G",username:"游客"}}else return{role:"游客",avatar:"G",username:"游客"}})()),p=k(null),h=k([]),F=k(null),$=k(0),T=k(!1),E=k(!1),U=k("newest"),D=k(null),P=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","👍","👎","❤️","🔥","🎉","👏","🤔","🤯","😱","🤩"],x=Y({content:""}),y=Y({content:"",replyTo:""}),W=me(()=>U.value==="newest"?[...h.value].sort((o,e)=>new Date(e.time)-new Date(o.time)):[...h.value].sort((o,e)=>new Date(o.time)-new Date(e.time))),H=()=>{z.push("/forum")},X=o=>{const e=localStorage.getItem("topics");if(e)try{const l=JSON.parse(e),c=l.findIndex(_=>String(_.id)===String(o));c!==-1&&(l[c].replies=h.value.length,localStorage.setItem("topics",JSON.stringify(l)))}catch(l){console.error("更新话题回复数失败",l)}},Z=()=>{var l;const o=w.params.id;if(!o){v.error("话题ID不存在"),z.push("/forum");return}const e=localStorage.getItem("topics");if(e)try{const c=JSON.parse(e),_=c.find(g=>String(g.id)===String(o));if(_){p.value=_,R({type:A.VIEW_TOPIC,topicId:_.id,topicTitle:_.title}),_.views=(_.views||0)+1,localStorage.setItem("topics",JSON.stringify(c));const g=`topic_likes_${o}`,S=localStorage.getItem(g);if(S){const V=JSON.parse(S);$.value=V.count||0;const N=(l=V.users)==null?void 0:l.includes(I.value.username);T.value=!!N}else $.value=0,T.value=!1}else v.error("话题不存在"),z.push("/forum")}catch(c){console.error("获取话题详情失败",c),v.error("获取话题详情失败")}else v.error("没有话题数据"),z.push("/forum")},ee=()=>{const o=w.params.id,e=localStorage.getItem(`comments_${o}`);if(e)try{h.value=JSON.parse(e)}catch(l){console.error("获取评论失败",l),h.value=[]}else h.value=[]},te=()=>{var l;if(!x.content.trim()){v.warning("评论内容不能为空");return}const o=w.params.id,e={id:Date.now().toString(),author:I.value.username,userAvatar:I.value.avatar,content:x.content,time:new Date().toLocaleString(),replies:[],likes:0};h.value.push(e),localStorage.setItem(`comments_${o}`,JSON.stringify(h.value)),X(o),R({type:A.COMMENT,topicId:o,topicTitle:(l=p.value)==null?void 0:l.title,commentContent:x.content}),x.content="",D.value=null,v.success("评论发表成功")},se=o=>{F.value=o.id,y.replyTo=o.author,y.content=""},M=()=>{F.value=null,y.content="",y.replyTo="",D.value=null},oe=o=>{var c;if(!y.content.trim()){v.warning("回复内容不能为空");return}const e=w.params.id,l={id:Date.now().toString(),author:I.value.username,userAvatar:I.value.avatar,content:y.content,time:new Date().toLocaleString(),replyTo:o.author,likes:0};o.replies||(o.replies=[]),o.replies.push(l),localStorage.setItem(`comments_${e}`,JSON.stringify(h.value)),R({type:A.REPLY,topicId:e,topicTitle:(c=p.value)==null?void 0:c.title,commentId:o.id,replyContent:y.content}),M(),v.success("回复发表成功")},le=()=>{var S,V;const o=w.params.id,e=`topic_likes_${o}`;let l={count:0,users:[]};const c=localStorage.getItem(e);if(c)try{l=JSON.parse(c)}catch(N){console.error("解析点赞数据失败",N)}const _=I.value.username,g=(S=l.users)==null?void 0:S.indexOf(_);g===-1||g===void 0?(l.count=(l.count||0)+1,l.users||(l.users=[]),l.users.push(_),T.value=!0,v.success("点赞成功")):(l.count=Math.max(0,(l.count||1)-1),l.users.splice(g,1),T.value=!1,v.info("已取消点赞")),$.value=l.count,localStorage.setItem(e,JSON.stringify(l)),R({type:A.LIKE_TOPIC,topicId:o,topicTitle:(V=p.value)==null?void 0:V.title,action:T.value?"点赞":"取消点赞"})},ne=o=>{o.likes||(o.likes=0),o.likes++;const e=w.params.id;localStorage.setItem(`comments_${e}`,JSON.stringify(h.value)),v.success("点赞成功")},ae=(o,e)=>{e.likes||(e.likes=0),e.likes++;const l=w.params.id;localStorage.setItem(`comments_${l}`,JSON.stringify(h.value)),v.success("点赞成功")},ie=()=>{E.value=!0},ce=()=>{const o=window.location.href;navigator.clipboard.writeText(o).then(()=>{v.success("链接已复制到剪贴板"),E.value=!1}).catch(e=>{console.error("复制失败:",e),v.error("复制失败")})},re=()=>{var o;(o=document.getElementById("comment-form"))==null||o.scrollIntoView({behavior:"smooth"})},j=o=>{D.value=D.value===o?null:o},G=(o,e)=>{e==="comment"?x.content+=o:e==="reply"&&(y.content+=o)};return ve(()=>{Z(),ee()}),(o,e)=>{const l=C("el-icon"),c=C("el-button"),_=C("el-avatar"),g=C("el-tag"),S=C("el-option"),V=C("el-select"),N=C("el-input"),ue=C("el-empty"),de=C("el-dialog");return d(),m("div",Ve,[t("div",De,[t("div",Ne,[s(c,{onClick:H,type:"text",class:"back-button"},{default:n(()=>[s(l,null,{default:n(()=>[s(f(he))]),_:1}),e[5]||(e[5]=r(" 返回列表 "))]),_:1}),e[6]||(e[6]=t("h1",null,"讨论详情",-1))]),t("div",Oe,[t("span",null,i(I.value.role),1),s(_,{size:40,class:"avatar"},{default:n(()=>[r(i(I.value.avatar),1)]),_:1})])]),p.value?(d(),m("div",Je,[t("div",be,[t("h2",ze,i(p.value.title),1),t("div",$e,[t("div",Ee,[s(_,{size:36,class:"author-avatar"},{default:n(()=>[r(i(p.value.author.charAt(0)),1)]),_:1}),t("div",Le,[t("span",Re,i(p.value.author),1),t("span",Ae,i(p.value.publishDate),1)])]),t("div",Fe,[s(g,{type:"info",effect:"plain",class:"category-tag"},{default:n(()=>[r(i(p.value.category),1)]),_:1}),t("span",Ue,[s(l,null,{default:n(()=>[s(f(ye))]),_:1}),r(" "+i(p.value.views),1)])])])]),t("div",Be,[t("p",null,i(p.value.content),1)]),p.value.tags&&p.value.tags.length>0?(d(),m("div",Pe,[(d(!0),m(J,null,b(p.value.tags,(a,L)=>(d(),Q(g,{key:L,size:"small",class:"tag-item",effect:"light"},{default:n(()=>[r(i(a),1)]),_:2},1024))),128))])):O("",!0),t("div",Me,[s(c,{type:"primary",plain:"",size:"small",onClick:le,class:fe({"is-liked":T.value})},{default:n(()=>[s(l,null,{default:n(()=>[s(f(B))]),_:1}),r(" "+i(T.value?"已赞":"点赞")+" ("+i($.value)+") ",1)]),_:1},8,["class"]),s(c,{type:"info",plain:"",size:"small",onClick:ie},{default:n(()=>[s(l,null,{default:n(()=>[s(f(ge))]),_:1}),e[7]||(e[7]=r(" 分享 "))]),_:1}),s(c,{type:"success",plain:"",size:"small",onClick:re},{default:n(()=>[s(l,null,{default:n(()=>[s(f(ke))]),_:1}),e[8]||(e[8]=r(" 评论 "))]),_:1})])])):O("",!0),t("div",je,[t("div",Ge,[t("h3",null,"评论 ("+i(h.value.length)+")",1),s(V,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a),placeholder:"排序方式",size:"small"},{default:n(()=>[s(S,{label:"最新",value:"newest"}),s(S,{label:"最早",value:"oldest"})]),_:1},8,["modelValue"])]),h.value.length>0?(d(),m("div",Ke,[(d(!0),m(J,null,b(W.value,(a,L)=>(d(),m("div",{key:L,class:"comment-item"},[t("div",Ye,[t("div",Qe,[s(_,{size:40,class:"comment-avatar"},{default:n(()=>[r(i(a.userAvatar),1)]),_:2},1024),t("div",qe,[t("span",We,i(a.author),1),t("span",He,i(a.time),1)])]),t("div",Xe,[s(c,{type:"text",onClick:u=>se(a)},{default:n(()=>[s(l,null,{default:n(()=>[s(f(Ce))]),_:1}),e[9]||(e[9]=r(" 回复 "))]),_:2},1032,["onClick"]),s(c,{type:"text",onClick:u=>ne(a)},{default:n(()=>[s(l,null,{default:n(()=>[s(f(B))]),_:1}),r(" "+i(a.likes||0),1)]),_:2},1032,["onClick"])])]),t("div",Ze,[t("p",null,i(a.content),1)]),a.replies&&a.replies.length>0?(d(),m("div",et,[(d(!0),m(J,null,b(a.replies,(u,K)=>(d(),m("div",{key:K,class:"reply-item"},[t("div",tt,[t("div",st,[s(_,{size:30,class:"reply-avatar"},{default:n(()=>[r(i(u.userAvatar),1)]),_:2},1024),t("div",ot,[t("span",lt,i(u.author),1),t("span",nt,i(u.time),1)])]),t("div",at,[s(c,{type:"text",size:"small",onClick:bt=>ae(a,u)},{default:n(()=>[s(l,null,{default:n(()=>[s(f(B))]),_:1}),r(" "+i(u.likes||0),1)]),_:2},1032,["onClick"])])]),t("div",it,[t("p",null,[t("span",ct,"@"+i(u.replyTo),1),r(" "+i(u.content),1)])])]))),128))])):O("",!0),F.value===a.id?(d(),m("div",rt,[D.value===a.id?(d(),m("div",ut,[t("div",dt,[(d(),m(J,null,b(P,u=>t("span",{key:u,onClick:K=>G(u,"reply")},i(u),9,pt)),64))])])):O("",!0),t("div",_t,[s(N,{modelValue:y.content,"onUpdate:modelValue":e[1]||(e[1]=u=>y.content=u),type:"textarea",rows:2,placeholder:"回复评论...",resize:"none"},null,8,["modelValue"]),t("div",mt,[s(c,{type:"text",onClick:u=>j(a.id)},{default:n(()=>[s(l,null,{default:n(()=>[s(f(q))]),_:1})]),_:2},1032,["onClick"])])]),t("div",vt,[s(c,{size:"small",onClick:M},{default:n(()=>e[10]||(e[10]=[r("取消")])),_:1}),s(c,{size:"small",type:"primary",onClick:u=>oe(a)},{default:n(()=>e[11]||(e[11]=[r("提交回复")])),_:2},1032,["onClick"])])])):O("",!0)]))),128))])):(d(),Q(ue,{key:1,description:"暂无评论，快来发表第一条评论吧！"})),t("div",ft,[e[13]||(e[13]=t("h4",null,"发表评论",-1)),D.value==="comment"?(d(),m("div",ht,[t("div",yt,[(d(),m(J,null,b(P,a=>t("span",{key:a,onClick:L=>G(a,"comment")},i(a),9,gt)),64))])])):O("",!0),t("div",kt,[s(N,{modelValue:x.content,"onUpdate:modelValue":e[2]||(e[2]=a=>x.content=a),type:"textarea",rows:4,placeholder:"请输入您的评论...",resize:"none"},null,8,["modelValue"]),t("div",Ct,[s(c,{type:"text",onClick:e[3]||(e[3]=a=>j("comment"))},{default:n(()=>[s(l,null,{default:n(()=>[s(f(q))]),_:1})]),_:1})])]),t("div",It,[s(c,{type:"primary",onClick:te},{default:n(()=>e[12]||(e[12]=[r("提交评论")])),_:1})])])]),s(de,{modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=a=>E.value=a),title:"分享话题",width:"400px"},{default:n(()=>{var a;return[t("div",St,[t("p",wt,i((a=p.value)==null?void 0:a.title),1),t("div",Tt,[t("div",{class:"share-option",onClick:ce},[s(l,null,{default:n(()=>[s(f(Ie))]),_:1}),e[14]||(e[14]=t("span",null,"复制链接",-1))]),t("div",xt,[s(l,null,{default:n(()=>[s(f(Se))]),_:1}),e[15]||(e[15]=t("span",null,"微信",-1))]),t("div",Vt,[s(l,null,{default:n(()=>[s(f(we))]),_:1}),e[16]||(e[16]=t("span",null,"微博",-1))]),t("div",Dt,[s(l,null,{default:n(()=>[s(f(Te))]),_:1}),e[17]||(e[17]=t("span",null,"QQ",-1))])])])]}),_:1},8,["modelValue"])])}}},Lt=xe(Nt,[["__scopeId","data-v-05b1277d"]]);export{Lt as default};
