import{g as c,i as p,s as w,a as m,b as y,c as M,d as f}from"./storage-02b3d0a9.js";const T=async e=>new Promise(t=>{setTimeout(()=>{const a={id:e,name:`资料${e}`,description:`这是资料${e}的详细描述，包含了相关的内容和信息。`,type:["document","image","video","other"][Math.floor(Math.random()*4)],uploadedAt:"2023-06-15",downloadCount:Math.floor(Math.random()*100),hierarchicalTags:["比赛","数学建模","比赛规则"]};t(a)},300)}),l={materials:[],nextId:5};l.materials.length===0&&(l.materials=[{id:1,name:"Python编程指南.pdf",description:"全面的Python编程语言指南，包含从基础到高级的全部内容",type:"document",uploadDate:"2023-06-15",size:"5.2MB",downloads:28,uploader:"管理员",file:null},{id:2,name:"数据结构思维导图.png",description:"包含常见数据结构的思维导图，直观展示各种数据结构的特点和应用",type:"image",uploadDate:"2023-06-10",size:"1.8MB",downloads:15,uploader:"张三",file:null},{id:3,name:"机器学习算法总结.docx",description:"常用机器学习算法的原理和应用场景总结",type:"document",uploadDate:"2023-05-22",size:"3.5MB",downloads:42,uploader:"李四",file:null},{id:4,name:"Web开发入门教程.mp4",description:"Web开发入门视频教程，包含HTML、CSS和JavaScript基础知识",type:"video",uploadDate:"2023-05-15",size:"120MB",downloads:36,uploader:"王五",file:null}]);const z=async()=>{try{const e=await c();return e.length===0?(await p(l.materials),await c()):e}catch(e){return console.error("获取资料失败:",e),[]}},S=async(e,t)=>{try{const a=await c(),r=a.length>0?Math.max(...a.map(n=>n.id))+1:1,o=t?B(t.size):"0MB";let i=[];e.hierarchicalTags&&Array.isArray(e.hierarchicalTags)&&(i=e.hierarchicalTags.map(n=>typeof n=="string"?n:JSON.stringify(n)));const s={id:r,name:e.name||t.name,description:e.description,type:e.type,uploadDate:new Date().toISOString().split("T")[0],size:o,downloads:0,uploader:e.uploader||"当前用户",hierarchicalTags:i,customTags:Array.isArray(e.customTags)?[...e.customTags]:[]};if(await m(s),t){const n=new FileReader;n.readAsArrayBuffer(t),await new Promise((h,u)=>{n.onload=async()=>{try{const d={id:`file_${s.id}`,materialId:s.id,name:t.name,type:t.type,size:t.size,data:n.result,url:URL.createObjectURL(t)};await y(d),h()}catch(d){u(d)}},n.onerror=()=>u(n.error)})}return g(s),s}catch(a){throw console.error("上传资料失败:",a),a}},b=async e=>{try{const a=(await c()).find(o=>o.id===e);if(!a)throw new Error("资料不存在");const r=await M(e);if(!r)throw new Error("文件数据不存在");if(a.downloads+=1,await m(a),r.url){const o=document.createElement("a");o.href=r.url,o.download=a.name,o.click()}else if(r.data){const o=new Blob([r.data],{type:r.type}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=a.name,s.click(),setTimeout(()=>URL.revokeObjectURL(i),100)}return a}catch(t){throw console.error("下载资料失败:",t),t}},F=async e=>{try{return await f(e)}catch(t){throw console.error("删除资料失败:",t),t}},I=e=>new Promise(t=>{const a=l.materials.find(o=>o.id===e);if(!a){t({success:!1,message:"资料不存在"});return}const r=`https://mindfile.example.com/share/${e}`;setTimeout(()=>{t({success:!0,shareLink:r,material:a})},300)}),L=async(e,t="all")=>{try{return await w(e,t)}catch(a){return console.error("搜索资料失败:",a),[]}},R=async e=>{try{const a=(await c()).find(r=>r.id===e);if(!a)throw new Error("资料不存在");return{data:{title:a.name,author:a.uploader,content:a.description,createdAt:a.uploadDate}}}catch(t){throw console.error("获取资料详情失败:",t),t}},x=async e=>{try{return{data:[{id:1,user:{name:"用户1"},content:"这个资料很有帮助",createdAt:"2023-06-20"},{id:2,user:{name:"用户2"},content:"内容很全面，感谢分享",createdAt:"2023-06-21"}]}}catch(t){throw console.error("获取评论失败:",t),t}},D=async(e,t)=>{try{return{data:{id:Date.now(),user:{name:"当前用户"},content:t.content,createdAt:new Date().toISOString()}}}catch(a){throw console.error("添加评论失败:",a),a}},g=e=>{console.log("将资料集成到思维导图搜索引擎:",e.name)},B=e=>{if(e===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+a[r]};export{z as a,I as b,F as c,b as d,R as e,B as f,T as g,x as h,D as i,L as s,S as u};
