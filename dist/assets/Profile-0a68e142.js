import{r as f,g as E,b as _,o as g,c as P,d as t,t as p,j as S,w as r,y as k,e as s,a7 as F,f as w,E as v,a8 as T,a9 as j}from"./index-9511e055.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";const R={class:"profile-container"},L={class:"page-header"},H={class:"user-info"},K={class:"profile-content"},Q={class:"user-card"},W={class:"user-avatar"},X={class:"user-details"},Y={class:"user-meta"},Z={key:0},$={class:"personal-info"},ee={class:"avatar-upload-container"},ae={key:0,class:"current-avatar"},le=["src"],se={key:1,class:"current-avatar"},te={class:"user-stats"},re={class:"stats-card"},oe={class:"stat-value"},ue={class:"stats-card"},ne={class:"stat-value"},ie={class:"stats-card"},de={class:"stat-value"},ve={class:"stats-card"},me={class:"stat-value"},ce={__name:"Profile",setup(pe){const J=f("basic"),U=f(null),b=f(null),N=()=>{const o=localStorage.getItem("currentUser");if(o)try{return JSON.parse(o)}catch(e){return console.error("解析用户数据失败",e),{role:"游客",avatar:"G",email:"",registerDate:""}}else return{role:"游客",avatar:"G",email:"",registerDate:""}},a=f(N()),y=f(null),O=()=>{if(a.value&&a.value.avatar==="CUSTOM"){const o=a.value.username||a.value.role;y.value=F(o)}else y.value=null},V=f({mindmapCount:5,materialsCount:12,postCount:8,replyCount:27}),l=f({username:a.value.username||"",bio:a.value.bio||"",interests:a.value.interests||"",expertise:a.value.expertise||"",education:a.value.education||"",location:a.value.location||""}),m=f({currentPassword:"",newPassword:"",confirmPassword:""}),c=f({email:a.value.email||"",avatar:a.value.avatar||""}),M={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,max:20,message:"密码长度应在6到20个字符之间",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度应在6到20个字符之间",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(o,e,u)=>{e===""?u(new Error("请再次输入新密码")):e!==m.value.newPassword?u(new Error("两次输入密码不一致")):u()},trigger:"blur"}]},B=()=>{const o=localStorage.getItem("users");if(!o){const e=[a.value];localStorage.setItem("users",JSON.stringify(e)),a.value.username=l.value.username,a.value.bio=l.value.bio,a.value.interests=l.value.interests,a.value.expertise=l.value.expertise,a.value.education=l.value.education,a.value.location=l.value.location,localStorage.setItem("currentUser",JSON.stringify(a.value)),v({message:"个人资料已更新",type:"success"});return}try{const e=JSON.parse(o),u=e.findIndex(d=>d.username===a.value.username);u===-1?e.push({...a.value,username:l.value.username,bio:l.value.bio,interests:l.value.interests,expertise:l.value.expertise,education:l.value.education,location:l.value.location}):(e[u].username=l.value.username,e[u].bio=l.value.bio,e[u].interests=l.value.interests,e[u].expertise=l.value.expertise,e[u].education=l.value.education,e[u].location=l.value.location),a.value.username=l.value.username,a.value.bio=l.value.bio,a.value.interests=l.value.interests,a.value.expertise=l.value.expertise,a.value.education=l.value.education,a.value.location=l.value.location,localStorage.setItem("users",JSON.stringify(e)),localStorage.setItem("currentUser",JSON.stringify(a.value)),v({message:"个人资料已更新",type:"success"})}catch(e){console.error("保存用户信息失败",e),v.error("保存失败，请重试")}},h=()=>{U.value&&U.value.validate(o=>{if(o){const e=localStorage.getItem("users");if(!e){v.error("用户数据获取失败");return}try{const u=JSON.parse(e),d=u.findIndex(n=>n.username===a.value.username&&n.password===m.value.currentPassword);if(d===-1){v.error("当前密码错误");return}u[d].password=m.value.newPassword,localStorage.setItem("users",JSON.stringify(u)),m.value.currentPassword="",m.value.newPassword="",m.value.confirmPassword="",v({message:"密码修改成功",type:"success"})}catch(u){console.error("修改密码失败",u),v.error("修改失败，请重试")}}})},z=async o=>{const e=o.raw.type==="image/jpeg",u=o.raw.type==="image/png";if(!e&&!u){v.error("头像图片只能是 JPG 或 PNG 格式!");return}if(!(o.raw.size/1024/1024<2)){v.error("头像图片大小不能超过 2MB!");return}try{const n=await T(o.raw);b.value=n}catch(n){console.error("头像预览失败:",n),v.error("头像预览失败，请重试")}},G=async()=>{const o=localStorage.getItem("users");if(!o){v.error("用户数据获取失败");return}try{const e=JSON.parse(o),u=e.findIndex(d=>d.username===a.value.username);if(u===-1){v.error("用户不存在");return}if(b.value){const d=a.value.username||a.value.role;if(await j(d,b.value))c.value.avatar="CUSTOM";else{v.error("头像保存失败，请重试");return}}e[u].email=c.value.email,e[u].avatar=c.value.avatar,a.value.email=c.value.email,a.value.avatar=c.value.avatar,localStorage.setItem("users",JSON.stringify(e)),localStorage.setItem("currentUser",JSON.stringify(a.value)),O(),v({message:"账户设置已更新",type:"success"}),b.value=null}catch(e){console.error("保存账户设置失败",e),v.error("保存失败，请重试")}};return E(()=>{const o=N();a.value=o,l.value.username=o.username||"",l.value.bio=o.bio||"",l.value.interests=o.interests||"",l.value.expertise=o.expertise||"",l.value.education=o.education||"",l.value.location=o.location||"",c.value.email=o.email||"",c.value.avatar=o.avatar||"",O()}),(o,e)=>{const u=_("el-avatar"),d=_("el-input"),n=_("el-form-item"),x=_("el-button"),I=_("el-form"),C=_("el-tab-pane"),A=_("el-upload"),D=_("el-tabs");return g(),P("div",R,[t("div",L,[e[11]||(e[11]=t("h1",null,"个人中心",-1)),t("div",H,[t("span",null,p(a.value.role),1),y.value?(g(),S(u,{key:0,size:40,class:"avatar",src:y.value},null,8,["src"])):(g(),S(u,{key:1,size:40,class:"avatar"},{default:r(()=>[w(p(a.value.avatar),1)]),_:1}))])]),t("div",K,[t("div",Q,[t("div",W,[y.value?(g(),S(u,{key:0,size:100,class:"large-avatar",src:y.value},null,8,["src"])):(g(),S(u,{key:1,size:100,class:"large-avatar"},{default:r(()=>[w(p(a.value.avatar),1)]),_:1}))]),t("div",X,[t("h2",null,p(a.value.username||a.value.role),1),t("div",Y,[t("p",null,"邮箱: "+p(a.value.email),1),t("p",null,"注册时间: "+p(a.value.registerDate),1),a.value.location?(g(),P("p",Z,"所在地: "+p(a.value.location),1)):k("",!0)])])]),t("div",$,[s(D,{modelValue:J.value,"onUpdate:modelValue":e[10]||(e[10]=i=>J.value=i)},{default:r(()=>[s(C,{label:"基本资料",name:"basic"},{default:r(()=>[e[13]||(e[13]=t("h2",null,"个人资料",-1)),s(I,{model:l.value,"label-width":"80px"},{default:r(()=>[s(n,{label:"用户名"},{default:r(()=>[s(d,{modelValue:l.value.username,"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.username=i),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(n,{label:"个人简介"},{default:r(()=>[s(d,{modelValue:l.value.bio,"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.bio=i),type:"textarea",rows:4,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1}),s(n,{label:"兴趣爱好"},{default:r(()=>[s(d,{modelValue:l.value.interests,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.interests=i),type:"textarea",rows:2,placeholder:"请输入您的兴趣爱好，多个兴趣用逗号分隔"},null,8,["modelValue"])]),_:1}),s(n,{label:"专业领域"},{default:r(()=>[s(d,{modelValue:l.value.expertise,"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.expertise=i),placeholder:"请输入您的专业领域或技能"},null,8,["modelValue"])]),_:1}),s(n,{label:"教育背景"},{default:r(()=>[s(d,{modelValue:l.value.education,"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.education=i),placeholder:"请输入您的教育背景"},null,8,["modelValue"])]),_:1}),s(n,{label:"所在地区"},{default:r(()=>[s(d,{modelValue:l.value.location,"onUpdate:modelValue":e[5]||(e[5]=i=>l.value.location=i),placeholder:"请输入您的所在地区"},null,8,["modelValue"])]),_:1}),s(n,null,{default:r(()=>[s(x,{type:"primary",onClick:B},{default:r(()=>e[12]||(e[12]=[w("保存修改")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(C,{label:"修改密码",name:"password"},{default:r(()=>[e[15]||(e[15]=t("h2",null,"修改密码",-1)),s(I,{model:m.value,rules:M,ref_key:"passwordFormRef",ref:U,"label-width":"100px"},{default:r(()=>[s(n,{label:"当前密码",prop:"currentPassword"},{default:r(()=>[s(d,{modelValue:m.value.currentPassword,"onUpdate:modelValue":e[6]||(e[6]=i=>m.value.currentPassword=i),type:"password","show-password":"",placeholder:"请输入当前密码"},null,8,["modelValue"])]),_:1}),s(n,{label:"新密码",prop:"newPassword"},{default:r(()=>[s(d,{modelValue:m.value.newPassword,"onUpdate:modelValue":e[7]||(e[7]=i=>m.value.newPassword=i),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),s(n,{label:"确认新密码",prop:"confirmPassword"},{default:r(()=>[s(d,{modelValue:m.value.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=i=>m.value.confirmPassword=i),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1}),s(n,null,{default:r(()=>[s(x,{type:"primary",onClick:h},{default:r(()=>e[14]||(e[14]=[w("修改密码")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(C,{label:"账户设置",name:"settings"},{default:r(()=>[e[19]||(e[19]=t("h2",null,"账户设置",-1)),s(I,{model:c.value,"label-width":"80px"},{default:r(()=>[s(n,{label:"邮箱"},{default:r(()=>[s(d,{modelValue:c.value.email,"onUpdate:modelValue":e[9]||(e[9]=i=>c.value.email=i),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),s(n,{label:"头像"},{default:r(()=>[t("div",ee,[b.value?(g(),P("div",ae,[t("img",{src:b.value,class:"avatar-preview"},null,8,le)])):c.value.avatar?(g(),P("div",se,[s(u,{size:100,class:"avatar-preview"},{default:r(()=>[w(p(c.value.avatar),1)]),_:1})])):k("",!0),s(A,{class:"avatar-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":z},{tip:r(()=>e[17]||(e[17]=[t("div",{class:"el-upload__tip"},"只能上传 jpg/png 文件，且不超过 2MB",-1)])),default:r(()=>[s(x,{type:"primary"},{default:r(()=>e[16]||(e[16]=[w("选择图片")])),_:1})]),_:1})])]),_:1}),s(n,null,{default:r(()=>[s(x,{type:"primary",onClick:G},{default:r(()=>e[18]||(e[18]=[w("保存设置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])]),t("div",te,[t("div",re,[e[20]||(e[20]=t("h3",null,"思维导图",-1)),t("div",oe,p(V.value.mindmapCount),1),e[21]||(e[21]=t("div",{class:"stat-label"},"已创建",-1))]),t("div",ue,[e[22]||(e[22]=t("h3",null,"学习资料",-1)),t("div",ne,p(V.value.materialsCount),1),e[23]||(e[23]=t("div",{class:"stat-label"},"已上传",-1))]),t("div",ie,[e[24]||(e[24]=t("h3",null,"讨论帖子",-1)),t("div",de,p(V.value.postCount),1),e[25]||(e[25]=t("div",{class:"stat-label"},"已发布",-1))]),t("div",ve,[e[26]||(e[26]=t("h3",null,"回复",-1)),t("div",me,p(V.value.replyCount),1),e[27]||(e[27]=t("div",{class:"stat-label"},"已参与",-1))])])])}}},we=q(ce,[["__scopeId","data-v-2d402f8c"]]);export{we as default};
