const S="mindfileDB";const l="materials",i="files",d=()=>new Promise((o,e)=>{const s=indexedDB.open(S,1);s.onerror=t=>{console.error("打开数据库失败:",t.target.error),e(t.target.error)},s.onsuccess=t=>{const r=t.target.result;o(r)},s.onupgradeneeded=t=>{const r=t.target.result;if(!r.objectStoreNames.contains(l)){const n=r.createObjectStore(l,{keyPath:"id"});n.createIndex("name","name",{unique:!1}),n.createIndex("type","type",{unique:!1}),n.createIndex("uploadDate","uploadDate",{unique:!1})}r.objectStoreNames.contains(i)||r.createObjectStore(i,{keyPath:"id"}).createIndex("materialId","materialId",{unique:!1})}}),f=async o=>{try{const e=await d();return new Promise((s,t)=>{const r=e.transaction([l],"readwrite"),a=r.objectStore(l).put(o);a.onsuccess=()=>{s(o)},a.onerror=c=>{console.error("保存资料失败:",c.target.error),t(c.target.error)},r.oncomplete=()=>{e.close()}})}catch(e){throw console.error("保存资料错误:",e),e}},b=async o=>{try{const e=await d();return new Promise((s,t)=>{const r=e.transaction([i],"readwrite"),a=r.objectStore(i).put(o);a.onsuccess=()=>{s(o)},a.onerror=c=>{console.error("保存文件失败:",c.target.error),t(c.target.error)},r.oncomplete=()=>{e.close()}})}catch(e){throw console.error("保存文件错误:",e),e}},y=async()=>{try{const o=await d();return new Promise((e,s)=>{const t=o.transaction([l],"readonly"),n=t.objectStore(l).getAll();n.onsuccess=()=>{e(n.result)},n.onerror=a=>{console.error("获取资料失败:",a.target.error),s(a.target.error)},t.oncomplete=()=>{o.close()}})}catch(o){return console.error("获取资料错误:",o),[]}},p=async o=>{try{const e=await d();return new Promise((s,t)=>{const r=e.transaction([i],"readonly"),c=r.objectStore(i).index("materialId").get(o);c.onsuccess=()=>{s(c.result)},c.onerror=g=>{console.error("获取文件失败:",g.target.error),t(g.target.error)},r.oncomplete=()=>{e.close()}})}catch(e){return console.error("获取文件错误:",e),null}},h=async o=>{try{const e=await d();return new Promise((s,t)=>{const r=e.transaction([l,i],"readwrite"),a=r.objectStore(l).delete(o);a.onerror=u=>{console.error("删除资料失败:",u.target.error),t(u.target.error)};const w=r.objectStore(i).index("materialId").openCursor(IDBKeyRange.only(o));w.onsuccess=u=>{const m=u.target.result;m&&(m.delete(),m.continue())},w.onerror=u=>{console.error("删除文件失败:",u.target.error),t(u.target.error)},r.oncomplete=()=>{e.close(),s({success:!0})}})}catch(e){throw console.error("删除资料和文件错误:",e),e}},x=async(o,e="all")=>{try{let t=[...await y()];if(o){const r=o.toLowerCase();t=t.filter(n=>n.name.toLowerCase().includes(r)||n.description.toLowerCase().includes(r))}return e!=="all"&&(t=t.filter(r=>r.type===e)),t}catch(s){return console.error("搜索资料错误:",s),[]}},I=async(o=[])=>{try{if((await y()).length===0&&o.length>0){for(const s of o)await f(s);console.log("示例数据已加载到数据库")}return!0}catch(e){return console.error("初始化数据库错误:",e),!1}};export{f as a,b,p as c,h as d,y as g,I as i,x as s};
